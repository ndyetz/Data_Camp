\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={Joining Data in R with dplyr},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}

  \title{Joining Data in R with dplyr}
    \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
  \subtitle{Lessons from DataCamp}
  \author{}
    \preauthor{}\postauthor{}
    \date{}
    \predate{}\postdate{}
  

\begin{document}
\maketitle

{
\setcounter{tocdepth}{3}
\tableofcontents
}
\section{Introduction}\label{introduction}

The following document outlines the written portion of the lessons from
\href{https://www.datacamp.com/}{DataCamp}'s
\href{https://www.datacamp.com/courses/joining-data-in-r-with-dplyr}{Joining
Data in R with dplyr}. This requires Intermediate R-Knowledge and
understanding of the dplyr package.

As a note: All text is completely copied and pasted from the course.
There are instances where the document refers to the ``editor on the
right'', please note, that in this notebook document all of the
instances are noted in the ``r-chunks'' (areas containing working
r-code), which occurs below the text, rather than to the right.
Furthermore, This lesson contained instructional videos at the beginning
of new concepts that are not detailed in this document. However, even
without these videos, the instructions are quite clear in indicating
what the code is accomplishing.

\emph{If you have this document open on ``R-Notebook'', simply click
``run'' -\textgreater{} ``Run all'' (Or just press `ctrl + alt + r'),
let the ``r-chunks'' run (This might take a bit of time) then click
``Preview''. There are 5 necessary datasets to run this program, please
create an r-project with this data or set a working directory (required
files names are available in the ``Required data for this session''
section)}

This document was created by Neil Yetz on 08/08/2018. Please send any
questions or concerns in this document to Neil at
\href{mailto:ndyetz@gmail.com}{\nolinkurl{ndyetz@gmail.com}}

\subsection{Required packages for this
session}\label{required-packages-for-this-session}

Below are the install.packages and libraries you will need to have in
order to run this session successfully.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(readr)}
\KeywordTok{library}\NormalTok{(dplyr)}
\KeywordTok{library}\NormalTok{(tibble)}
\KeywordTok{library}\NormalTok{(purrr)}
\end{Highlighting}
\end{Shaded}

\subsection{Required data for this
session}\label{required-data-for-this-session}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{setwd}\NormalTok{(}\StringTok{"Data/"}\NormalTok{)}

\CommentTok{#read all .csv files}
\NormalTok{temp =}\StringTok{ }\KeywordTok{list.files}\NormalTok{(}\DataTypeTok{pattern=}\StringTok{"*.csv"}\NormalTok{)}
\KeywordTok{list2env}\NormalTok{(}
  \KeywordTok{lapply}\NormalTok{(}\KeywordTok{setNames}\NormalTok{(temp, }\KeywordTok{make.names}\NormalTok{(}\KeywordTok{gsub}\NormalTok{(}\StringTok{"*.csv$"}\NormalTok{, }\StringTok{""}\NormalTok{, temp))), }
\NormalTok{         read_csv), }\DataTypeTok{envir =}\NormalTok{ .GlobalEnv)}
\KeywordTok{rm}\NormalTok{(temp)}


\CommentTok{#load R files}
\NormalTok{eighties <-}\StringTok{ }\KeywordTok{readRDS}\NormalTok{(}\StringTok{"eighties.RDS"}\NormalTok{)}
\NormalTok{lahmanNames <-}\StringTok{ }\KeywordTok{readRDS}\NormalTok{(}\StringTok{"lahmanNames.RDS"}\NormalTok{)}
\NormalTok{seventies <-}\StringTok{ }\KeywordTok{readRDS}\NormalTok{(}\StringTok{"seventies.RDS"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\section{Course Description}\label{course-description}

This course builds on what you learned in Data Manipulation in R with
dplyr by showing you how to combine data sets with dplyr's two table
verbs. In the real world, data comes split across many data sets, but
dplyr's core functions are designed to work with single tables of data.
In this course, you'll learn the best ways to combine data sets into
single tables. You'll learn how to augment columns from one data set
with columns from another with mutating joins, how to filter one data
set against another with filtering joins, and how to sift through data
sets with set operations. Along the way, you'll discover the best
practices for building data sets and troubleshooting joins with dplyr.
Afterwards, youâll be well on your way to data manipulation mastery!

\section{Chapter 1: Mutating joins}\label{chapter-1-mutating-joins}

Mutating joins add new variables to one dataset from another dataset,
matching observations across rows in the process. This chapter will
explain the various ways you can join datasets together and what happens
when you do.

\subsection{A basic join}\label{a-basic-join}

As Garrett mentioned in the video, left\_join() is the basic join
function in dplyr. You can use it whenever you want to augment a data
frame with information from another data frame.

For example, left\_join(x, y) joins y to x. The second dataset you
specify is joined to the first dataset. Keep that in mind as you go
through the course.

For this exercise, the code in the editor sets up a left join but
doesn't finish it. It's up to you to complete it.

INSTRUCTIONS

Complete the code to join artists to bands. bands2 should contain all of
the information in bands supplemented with information in artists.

Print bands2 to the console to see the result.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Complete the code to join artists to bands}
\NormalTok{bands2 <-}\StringTok{ }\KeywordTok{left_join}\NormalTok{(bands, artists, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"first"}\NormalTok{, }\StringTok{"last"}\NormalTok{))}

\CommentTok{# Examine the results}
\NormalTok{bands2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 12 x 4
##    first     last      band               instrument
##    <chr>     <chr>     <chr>              <chr>     
##  1 John      Bonham    Led Zeppelin       <NA>      
##  2 John Paul Jones     Led Zeppelin       <NA>      
##  3 Jimmy     Page      Led Zeppelin       Guitar    
##  4 Robert    Plant     Led Zeppelin       <NA>      
##  5 George    Harrison  The Beatles        Guitar    
##  6 John      Lennon    The Beatles        Guitar    
##  7 Paul      McCartney The Beatles        Bass      
##  8 Ringo     Starr     The Beatles        Drums     
##  9 Jimmy     Buffett   The Coral Reefers  Guitar    
## 10 Mick      Jagger    The Rolling Stones Vocals    
## 11 Keith     Richards  The Rolling Stones Guitar    
## 12 Charlie   Watts     The Rolling Stones <NA>
\end{verbatim}

\subsection{A second join}\label{a-second-join}

You should always check the output of your joins. Just because a join
worked, doesn't mean that it worked as you expected.

For example, the code in the editor joins the same two datasets that you
joined in the previous exercise, but it returns a different result. Can
you tell what went wrong?

INSTRUCTIONS

The result from the previous exercise, bands2, is loaded in your
workspace.

Examine the output from the code provided in the editor. How is it
different from bands2? Fix the code so that the result is identical to
bands2.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Fix the code to recreate bands2}
\KeywordTok{left_join}\NormalTok{(bands, artists, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"first"}\NormalTok{, }\StringTok{"last"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 12 x 4
##    first     last      band               instrument
##    <chr>     <chr>     <chr>              <chr>     
##  1 John      Bonham    Led Zeppelin       <NA>      
##  2 John Paul Jones     Led Zeppelin       <NA>      
##  3 Jimmy     Page      Led Zeppelin       Guitar    
##  4 Robert    Plant     Led Zeppelin       <NA>      
##  5 George    Harrison  The Beatles        Guitar    
##  6 John      Lennon    The Beatles        Guitar    
##  7 Paul      McCartney The Beatles        Bass      
##  8 Ringo     Starr     The Beatles        Drums     
##  9 Jimmy     Buffett   The Coral Reefers  Guitar    
## 10 Mick      Jagger    The Rolling Stones Vocals    
## 11 Keith     Richards  The Rolling Stones Guitar    
## 12 Charlie   Watts     The Rolling Stones <NA>
\end{verbatim}

\subsection{A right join}\label{a-right-join}

There is more than one way to execute a left join. Knowing multiple
methods will make you a more versatile data scientist, especially as you
try to fit joins into pipes created with \%\textgreater{}\%.

In this exercise, you'll recreate bands2 once more, but this time
without using a left\_join().

INSTRUCTIONS

Use right\_join() to create bands3, a new dataset that contains the same
information as bands2. Use setequal() to check that the datasets are the
same.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Finish the code below to recreate bands3 with a right join}
\NormalTok{bands2 <-}\StringTok{ }\KeywordTok{left_join}\NormalTok{(bands, artists, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"first"}\NormalTok{, }\StringTok{"last"}\NormalTok{))}
\NormalTok{bands3 <-}\StringTok{ }\KeywordTok{right_join}\NormalTok{(artists, bands, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"first"}\NormalTok{, }\StringTok{"last"}\NormalTok{))}

\CommentTok{# Check that bands3 is equal to bands2}
\KeywordTok{setequal}\NormalTok{(bands2, bands3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## TRUE
\end{verbatim}

\subsection{Inner joins and full
joins}\label{inner-joins-and-full-joins}

You may have noticed that some of the songs in songs correspond to some
of the albums in albums. Suppose you want a new dataset that contains
all of the songs for which you have data from both albums and songs. How
would you make it?

The artists and bands datasets also share some information. What if you
want to join these two datasets in such a way that you retain all of the
information available in both tables, without throwing anything away?

You can think of inner joins as the most strict type of join: they only
retain observations that appear in both datasets. In contrast, full
joins are the most permissive type of join: they return all of the data
that appears in both datasets (often resulting in many missing values).

Recall that, *\_join(x, y) joins y to x. The second dataset you specify
is joined to the first dataset.

INSTRUCTIONS

Join albums to songs in a way that returns only rows that contain
information about both songs and albums. Join bands to artists to create
a single table that contains all of the available data.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Join albums to songs using inner_join()}
\KeywordTok{inner_join}\NormalTok{(songs, albums, }\DataTypeTok{by =} \StringTok{"album"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 6
##   song           album                first  last      band         year
##   <chr>          <chr>                <chr>  <chr>     <chr>       <int>
## 1 Come Together  Abbey Road           John   Lennon    The Beatles  1969
## 2 Dream On       Aerosmith            Steven Tyler     Aerosmith    1973
## 3 Hello, Goodbye Magical Mystery Tour Paul   McCartney The Beatles  1967
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Join bands to artists using full_join()}
\KeywordTok{full_join}\NormalTok{(artists, bands, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"first"}\NormalTok{, }\StringTok{"last"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 20 x 4
##    first     last      instrument band              
##    <chr>     <chr>     <chr>      <chr>             
##  1 Jimmy     Buffett   Guitar     The Coral Reefers 
##  2 George    Harrison  Guitar     The Beatles       
##  3 Mick      Jagger    Vocals     The Rolling Stones
##  4 Tom       Jones     Vocals     <NA>              
##  5 Davy      Jones     Vocals     <NA>              
##  6 John      Lennon    Guitar     The Beatles       
##  7 Paul      McCartney Bass       The Beatles       
##  8 Jimmy     Page      Guitar     Led Zeppelin      
##  9 Joe       Perry     Guitar     <NA>              
## 10 Elvis     Presley   Vocals     <NA>              
## 11 Keith     Richards  Guitar     The Rolling Stones
## 12 Paul      Simon     Guitar     <NA>              
## 13 Ringo     Starr     Drums      The Beatles       
## 14 Joe       Walsh     Guitar     <NA>              
## 15 Brian     Wilson    Vocals     <NA>              
## 16 Nancy     Wilson    Vocals     <NA>              
## 17 John      Bonham    <NA>       Led Zeppelin      
## 18 John Paul Jones     <NA>       Led Zeppelin      
## 19 Robert    Plant     <NA>       Led Zeppelin      
## 20 Charlie   Watts     <NA>       The Rolling Stones
\end{verbatim}

\subsection{Pipes}\label{pipes}

You can combine dplyr functions together with the pipe operator,
\%\textgreater{}\%, to build up an analysis step-by-step.
\%\textgreater{}\% takes the result of the code that comes before it and
``pipes'' it into the function that comes after it as the first argument
of the function.

So for example, the two pieces of code below do the same thing:

\begin{verbatim}
full_join(artists, bands, 
          by = c("first", "last"))

artists %>% 
  full_join(bands, by = c("first", "last"))
\end{verbatim}

Pipes are so efficient for multi-step analysis that you will use them
for the remainder of the exercises in this course. (If you need a
refresher on the pipe operator, check out Data Manipulation in R with
dplyr course!)

INSTRUCTIONS

The code in the editor finds all of the known guitarists in the bands
dataset. Rewrite the code to use \%\textgreater{}\%s instead of multiple
function calls. The pipe \%\textgreater{}\% should be used three times
and temp zero times.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Find guitarists in bands dataset (don't change)}
\NormalTok{temp <-}\StringTok{ }\KeywordTok{left_join}\NormalTok{(bands, artists, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"first"}\NormalTok{, }\StringTok{"last"}\NormalTok{))}
\NormalTok{temp <-}\StringTok{ }\KeywordTok{filter}\NormalTok{(temp, instrument }\OperatorTok{==}\StringTok{ "Guitar"}\NormalTok{)}
\KeywordTok{select}\NormalTok{(temp, first, last, band)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 3
##   first  last     band              
##   <chr>  <chr>    <chr>             
## 1 Jimmy  Page     Led Zeppelin      
## 2 George Harrison The Beatles       
## 3 John   Lennon   The Beatles       
## 4 Jimmy  Buffett  The Coral Reefers 
## 5 Keith  Richards The Rolling Stones
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Reproduce code above using pipes}
\NormalTok{bands }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{left_join}\NormalTok{(artists, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"first"}\NormalTok{, }\StringTok{"last"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(instrument }\OperatorTok{==}\StringTok{ "Guitar"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(first, last, band)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 3
##   first  last     band              
##   <chr>  <chr>    <chr>             
## 1 Jimmy  Page     Led Zeppelin      
## 2 George Harrison The Beatles       
## 3 John   Lennon   The Beatles       
## 4 Jimmy  Buffett  The Coral Reefers 
## 5 Keith  Richards The Rolling Stones
\end{verbatim}

\subsection{Practice with pipes and
joins}\label{practice-with-pipes-and-joins}

We've created a data frame for you called goal. It's available in your
workspace, so go ahead and take a look. Your mission, if you choose to
accept it, is to create a dataset that's identical to goal.

INSTRUCTIONS

Examine the goal dataset by printing it to the console. Write a pipe
that uses a full join and an inner join to combine artists, bands, and
songs into goal2, a dataset identical to goal. Use setequal() to check
that goal is identical to goal2.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Examine the contents of the goal dataset}
\NormalTok{goal}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 6
##   first last      instrument band        song           album             
##   <chr> <chr>     <chr>      <chr>       <chr>          <chr>             
## 1 Tom   Jones     Vocals     <NA>        It's Not Unus~ Along Came Jones  
## 2 John  Lennon    Guitar     The Beatles Come Together  Abbey Road        
## 3 Paul  McCartney Bass       The Beatles Hello, Goodbye Magical Mystery T~
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Create goal2 using full_join() and inner_join() }
\NormalTok{goal2 <-}\StringTok{ }\NormalTok{artists }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{full_join}\NormalTok{(bands, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"first"}\NormalTok{, }\StringTok{"last"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{inner_join}\NormalTok{(songs, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"first"}\NormalTok{, }\StringTok{"last"}\NormalTok{))}
  
  
  
\CommentTok{# Check that goal and goal2 are the same}
\KeywordTok{setequal}\NormalTok{(goal, goal2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## TRUE
\end{verbatim}

\subsection{Choose your joins}\label{choose-your-joins}

You're getting the hang of pipes now! They are a very useful way to
combine multiple joins to make a single dataset.

Let's craft one more dataset before moving to Chapter 2. One of the most
useful ways to combine data is to place all of the values of all of the
datasets into a single table.

INSTRUCTIONS

Write a pipe that combines artists, bands, songs, and albums (in that
order) into a single table, such that it contains all of the information
in the datasets.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Create one table that combines all information}
\NormalTok{artists }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{full_join}\NormalTok{(bands,  }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"first"}\NormalTok{, }\StringTok{"last"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{full_join}\NormalTok{(songs,  }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"first"}\NormalTok{, }\StringTok{"last"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{full_join}\NormalTok{(albums, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"album"}\NormalTok{, }\StringTok{"band"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 28 x 7
##    first  last     instrument band         song        album          year
##    <chr>  <chr>    <chr>      <chr>        <chr>       <chr>         <int>
##  1 Jimmy  Buffett  Guitar     The Coral R~ <NA>        <NA>             NA
##  2 George Harrison Guitar     The Beatles  <NA>        <NA>             NA
##  3 Mick   Jagger   Vocals     The Rolling~ <NA>        <NA>             NA
##  4 Tom    Jones    Vocals     <NA>         It's Not U~ Along Came J~    NA
##  5 Davy   Jones    Vocals     <NA>         <NA>        <NA>             NA
##  6 John   Lennon   Guitar     The Beatles  Come Toget~ Abbey Road     1969
##  7 Paul   McCartn~ Bass       The Beatles  Hello, Goo~ Magical Myst~  1967
##  8 Jimmy  Page     Guitar     Led Zeppelin <NA>        <NA>             NA
##  9 Joe    Perry    Guitar     <NA>         <NA>        <NA>             NA
## 10 Elvis  Presley  Vocals     <NA>         <NA>        <NA>             NA
## # ... with 18 more rows
\end{verbatim}

\section{Chapter 2: Filtering joins and set
operations}\label{chapter-2-filtering-joins-and-set-operations}

Filtering joins and set operations combine information from datasets
without adding new variables. Filtering joins filter the observations of
one dataset based on whether or not they occur in a second dataset. Set
operations use combinations of observations from both datasets to create
a new dataset.

\subsection{Apply a semi-join}\label{apply-a-semi-join}

As you saw in the video, semi-joins provide a concise way to filter data
from the first dataset based on information in a second dataset.

For example, the code in the editor uses semi\_join() to create a data
frame of the artists in artists who have written a song in songs.

INSTRUCTIONS

Run the semi\_join() command to see its output. Then fill in the blanks
of the right\_join(), filter(), and select() calls to create the same
result.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# View the output of semi_join()}
\NormalTok{artists }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{semi_join}\NormalTok{(songs, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"first"}\NormalTok{, }\StringTok{"last"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 3
##   first last      instrument
##   <chr> <chr>     <chr>     
## 1 Tom   Jones     Vocals    
## 2 John  Lennon    Guitar    
## 3 Paul  McCartney Bass
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Create the same result}
\NormalTok{artists }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{right_join}\NormalTok{(songs, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"first"}\NormalTok{, }\StringTok{"last"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(instrument)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{select}\NormalTok{(first, last, instrument)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 3
##   first last      instrument
##   <chr> <chr>     <chr>     
## 1 John  Lennon    Guitar    
## 2 Paul  McCartney Bass      
## 3 Tom   Jones     Vocals
\end{verbatim}

\subsection{Exploring with semi-joins}\label{exploring-with-semi-joins}

Semi-joins provide a useful way to explore the connections between
multiple tables of data.

For example, you can use a semi-join to determine the number of albums
in the albums dataset that were made by a band in the bands dataset.

INSTRUCTIONS

For the first pipe, use semi\_join() to collect the albums in albums
that were made by a band in bands. For the second pipe, use nrow() to
count how many albums were made by a band in the dataset.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{albums }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Collect the albums made by a band}
\StringTok{    }\KeywordTok{semi_join}\NormalTok{(bands, }\DataTypeTok{by =} \StringTok{"band"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Count the albums made by a band}
\StringTok{  }\KeywordTok{nrow}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5
\end{verbatim}

\subsection{Apply an anti-join}\label{apply-an-anti-join}

As Garrett mentioned in the video, anti-joins provide a useful way to
reason about how a mutating join will work before you apply the join.

For example, you can use an anti-join to see which rows will not be
matched to a second dataset by a join.

INSTRUCTIONS

Use an anti\_join() to return the rows of artists for which you don't
have any bands info. Note: Don't forget to mention the by argument.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Return rows of artists that don't have bands info}
\NormalTok{artists }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{anti_join}\NormalTok{(bands, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"first"}\NormalTok{, }\StringTok{"last"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 8 x 3
##   first last    instrument
##   <chr> <chr>   <chr>     
## 1 Tom   Jones   Vocals    
## 2 Davy  Jones   Vocals    
## 3 Joe   Perry   Guitar    
## 4 Elvis Presley Vocals    
## 5 Paul  Simon   Guitar    
## 6 Joe   Walsh   Guitar    
## 7 Brian Wilson  Vocals    
## 8 Nancy Wilson  Vocals
\end{verbatim}

\subsection{Apply another anti-join}\label{apply-another-anti-join}

Anti-joins with anti\_join() also provide a great way to diagnose joins
that go wrong.

For example, they can help you zero-in on rows that have capitalization
or spelling errors in the keys. These things will make your primary and
secondary keys appear different to R, even though you know they refer to
the same thing.

INSTRUCTIONS

labels describes the record labels of the albums in albums. Compare the
spellings of album names in labels with the names in albums. Are any of
the album names of labels mis-entered? Use anti\_join() to check. Note:
Don't forget to mention the by argument.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Check whether album names in labels are mis-entered}
\NormalTok{labels }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{anti_join}\NormalTok{(albums, }\DataTypeTok{by =} \StringTok{"album"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 2
##   album             label     
##   <chr>             <chr>     
## 1 A Hard Days Night Parlophone
\end{verbatim}

\subsection{Which filtering join?}\label{which-filtering-join}

Think you have filtering joins down? Let's check.

Which filtering join would you use to determine how many rows in songs
match a label in labels?

INSTRUCTIONS

Determine which key joins labels and songs. Use a filtering join to find
the rows of songs that match a row in labels. Use nrow() to determine
how many matches exist between labels and songs.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Determine which key joins labels and songs}
\NormalTok{labels}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 9 x 2
##   album                     label          
##   <chr>                     <chr>          
## 1 Abbey Road                Apple          
## 2 A Hard Days Night         Parlophone     
## 3 Magical Mystery Tour      Parlophone     
## 4 Led Zeppelin IV           Atlantic       
## 5 The Dark Side of the Moon Harvest        
## 6 Hotel California          Asylum         
## 7 Rumours                   Warner Brothers
## 8 Aerosmith                 Columbia       
## 9 Beggar's Banquet          Decca
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{songs}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 4
##   song             album                first  last     
##   <chr>            <chr>                <chr>  <chr>    
## 1 Come Together    Abbey Road           John   Lennon   
## 2 Dream On         Aerosmith            Steven Tyler    
## 3 Hello, Goodbye   Magical Mystery Tour Paul   McCartney
## 4 It's Not Unusual Along Came Jones     Tom    Jones
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Check your understanding}
\NormalTok{songs }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Find the rows of songs that match a row in labels}
\StringTok{  }\KeywordTok{semi_join}\NormalTok{(labels, }\DataTypeTok{by =} \StringTok{"album"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Number of matches between labels and songs}
\StringTok{  }\KeywordTok{nrow}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3
\end{verbatim}

\subsection{How many songs are there?}\label{how-many-songs-are-there}

We have loaded two datasets in your workspace, aerosmith and
greatest\_hits, each of which represents an album from the band
Aerosmith. Each row in either of the datasets is a song on that album.

How many unique songs do these two albums contain in total?

INSTRUCTIONS

Use a set operation to create a dataset with every song contained on
aerosmith and/or greatest\_hits. Use nrow() to count the total number of
songs.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{aerosmith }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Create the new dataset using a set operation}
\StringTok{  }\KeywordTok{union}\NormalTok{(greatest_hits) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Count the total number of songs}
\StringTok{  }\KeywordTok{nrow}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 24
\end{verbatim}

\subsection{Greatest hits}\label{greatest-hits}

Which songs from Aerosmith made it onto Greatest Hits?

INSTRUCTIONS

Use a set operation to create a dataset containing every track that is
in both Aerosmith and Greatest Hits.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Create the new dataset using a set operation}
\NormalTok{aerosmith }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{intersect}\NormalTok{(greatest_hits)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 2
##   song     length
##   <chr>    <time>
## 1 Dream On 04:28
\end{verbatim}

\subsection{Live! Bootleg songs}\label{live-bootleg-songs}

live contains the songs from a third Aerosmith album, Live! Bootleg.

Which songs are on Live! Bootleg but not on Greatest Hits? Notice that
the length of songs may be different when they are performed live.

INSTRUCTIONS

Select just the song names from live.

Select just the song names from greatest\_hits.

Use a set operation to create a dataset of songs in live that are not in
greatest\_hits.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Select the song names from live}
\NormalTok{live_songs <-}\StringTok{ }\NormalTok{live }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(song)}

\CommentTok{# Select the song names from greatest_hits}
\NormalTok{greatest_songs <-}\StringTok{ }\NormalTok{greatest_hits }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(song)}

\CommentTok{# Create the new dataset using a set operation}
\NormalTok{live_songs }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{setdiff}\NormalTok{(greatest_songs)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 8 x 1
##   song                                       
##   <chr>                                      
## 1 Lord of the Thighs                         
## 2 Toys in the Attic                          
## 3 Sick as a Dog                              
## 4 Sight for Sore Eyes                        
## 5 S.O.S. (Too Bad)                           
## 6 I Ain't Got You                            
## 7 Mother Popcorn/Draw the Line               
## 8 Train Kept A-Rollin'/Strangers in the Night
\end{verbatim}

\subsection{Multiple operations}\label{multiple-operations}

There is no set operation to find rows that appear in one data frame or
another, but not both. However, you can accomplish this by combining set
operators, as Garrett showed in the video.

Can you think of a combination that would answer the question, ``Which
songs appear on one of Live! Bootleg or Greatest Hits, but not both?''

INSTRUCTIONS

Select the songs from the live and greatest\_hits datasets and call them
live\_songs and greatest\_songs, respectively. Use the select() function
to do this. Combine setdiff(), union(), and intersect() to return all of
the songs that are in one of live\_songs or greatest\_songs, but not
both. You will need to use all three functions and save some results
along the way (i.e.~you won't be able to do this with a single pipe.)

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Select songs from live and greatest_hits}
\NormalTok{live_songs <-}\StringTok{ }\KeywordTok{select}\NormalTok{(live, song)}
\NormalTok{greatest_songs <-}\StringTok{ }\KeywordTok{select}\NormalTok{(greatest_hits, song)}

\CommentTok{# Return the songs that only exist in one dataset}
\NormalTok{all_songs <-}\StringTok{ }\KeywordTok{union}\NormalTok{(live_songs, greatest_songs)}
\NormalTok{both_songs <-}\StringTok{ }\KeywordTok{intersect}\NormalTok{(live_songs, greatest_songs)}
\NormalTok{one_songs <-}\StringTok{ }\KeywordTok{setdiff}\NormalTok{(all_songs, both_songs)}
\NormalTok{one_songs}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 17 x 1
##    song                                       
##    <chr>                                      
##  1 One Way Street (live)                      
##  2 Sweet Emotion (remix)                      
##  3 I Ain't Got You                            
##  4 Sick as a Dog                              
##  5 Lightning Strikes                          
##  6 Draw the Line                              
##  7 Mother Popcorn/Draw the Line               
##  8 Remember (Walking in the Sand)             
##  9 S.O.S. (Too Bad)                           
## 10 Kings and Queens                           
## 11 Sight for Sore Eyes                        
## 12 Toys in the Attic                          
## 13 Big Ten Inch Record                        
## 14 Train Kept A-Rollin'/Strangers in the Night
## 15 Lord of the Thighs                         
## 16 Seasons of Winter                          
## 17 Same Old Song and Dance
\end{verbatim}

\subsection{Apply setequal}\label{apply-setequal}

definitive and complete contain the songs that appear in competing Led
Zeppelin anthologies: The Definitive Collection and The Complete Studio
Recordings, respectively.

Both anthologies claim to contain the complete studio recordings of Led
Zeppelin, but do the anthologies contain the same exact songs?

INSTRUCTIONS

Use identical() to determine whether definitive and complete contain the
same songs in the same order. Use setequal() to determine whether
definitive and complete contain the same songs in any order. Use
setdiff() to see which songs (if any) are in definitive but not
complete. Use setdiff() to see which songs (if any) are in complete but
not definitive.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Check if same order: definitive and complete}
\KeywordTok{identical}\NormalTok{(definitive, complete)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Check if any order: definitive and complete}
\KeywordTok{setequal}\NormalTok{(definitive, complete)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## FALSE: Different number of rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Songs in definitive but not complete}
\KeywordTok{setdiff}\NormalTok{(definitive, complete)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 15 x 2
##    song                        album                    
##    <chr>                       <chr>                    
##  1 Rock and Roll               The Song Remains the Same
##  2 Celebration Day             The Song Remains the Same
##  3 Black Dog                   The Song Remains the Same
##  4 Over the Hills and Far Away The Song Remains the Same
##  5 Misty Mountain Hop          The Song Remains the Same
##  6 Since I've Been Loving You  The Song Remains the Same
##  7 No Quarter                  The Song Remains the Same
##  8 The Song Remains the Same   The Song Remains the Same
##  9 The Rain Song               The Song Remains the Same
## 10 The Ocean                   The Song Remains the Same
## 11 Dazed and Confused          The Song Remains the Same
## 12 Stairway to Heaven          The Song Remains the Same
## 13 Moby Dick                   The Song Remains the Same
## 14 Heartbreaker                The Song Remains the Same
## 15 Whole Lotta Love            The Song Remains the Same
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Songs in complete but not definitive}
\KeywordTok{setdiff}\NormalTok{(complete, definitive)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 0 x 2
## # ... with 2 variables: song <chr>, album <chr>
\end{verbatim}

\subsection{Apply setequal again}\label{apply-setequal-again}

A few exercises ago, you saw that an intersect() is analagous to a
semi\_join() when two datasets contain the same variables and each
variable is used in the key.

Under these conditions, setdiff() is also analagous to one of the
filtering joins.

INSTRUCTIONS

Write a filtering join that returns songs in definitive that are not in
complete. Are there any? Write a filtering join that returns songs in
complete that are not in definitive. Are there any?

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Return songs in definitive that are not in complete}
\NormalTok{definitive }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{anti_join}\NormalTok{(complete, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"song"}\NormalTok{, }\StringTok{"album"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 15 x 2
##    song                        album                    
##    <chr>                       <chr>                    
##  1 Rock and Roll               The Song Remains the Same
##  2 Celebration Day             The Song Remains the Same
##  3 Black Dog                   The Song Remains the Same
##  4 Over the Hills and Far Away The Song Remains the Same
##  5 Misty Mountain Hop          The Song Remains the Same
##  6 Since I've Been Loving You  The Song Remains the Same
##  7 No Quarter                  The Song Remains the Same
##  8 The Song Remains the Same   The Song Remains the Same
##  9 The Rain Song               The Song Remains the Same
## 10 The Ocean                   The Song Remains the Same
## 11 Dazed and Confused          The Song Remains the Same
## 12 Stairway to Heaven          The Song Remains the Same
## 13 Moby Dick                   The Song Remains the Same
## 14 Heartbreaker                The Song Remains the Same
## 15 Whole Lotta Love            The Song Remains the Same
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Return songs in complete that are not in definitive}
\NormalTok{complete }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{anti_join}\NormalTok{(definitive, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"song"}\NormalTok{, }\StringTok{"album"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 0 x 2
## # ... with 2 variables: song <chr>, album <chr>
\end{verbatim}

\subsection{Comparing albums}\label{comparing-albums}

It appears that The Definitive Collection contains songs from the
soundtrack of The Song Remains the Same, a movie filmed during a live
Led Zeppelin concert. Is this the only difference between The Definitive
Collection and The Complete Studio Recordings?

INSTRUCTIONS

The songs from The Song Remains the Same are contained in soundtrack.

Use identical() to check if definitive and the union of complete and
soundtrack contain the same songs in the same order. Use setequal() to
check if definitive and the union of complete and soundtrack contain the
same songs in any order.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Check if same order: definitive and union of complete and soundtrack}
\KeywordTok{identical}\NormalTok{(definitive, }\KeywordTok{union}\NormalTok{(complete, soundtrack))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Check if any order: definitive and union of complete and soundtrack}
\KeywordTok{setequal}\NormalTok{(definitive, }\KeywordTok{union}\NormalTok{(complete, soundtrack))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## TRUE
\end{verbatim}

\section{Chapter 3: Assembling data}\label{chapter-3-assembling-data}

This chapter will show you how to build datasets from basic elements:
vectors, lists, and individual datasets that do not require a join.
dplyr contains a set of functions for assembling data that work more
intuitively than base R's functions. The chapter will also look at when
dplyr does and does not use data type coercion.

\subsection{Which bind?}\label{which-bind}

side\_one and side\_two contain tracks from sides one and two,
respectively, of Pink Floyd's famous album The Dark Side of the Moon.

Bind these datasets into a single table using a dplyr function. Which
type of bind should you use?

INSTRUCTIONS

Examine side\_one and side\_two by printing them to the console. Use a
bind to combine side\_one and side\_two into a single dataset.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Examine side_one and side_two}
\NormalTok{side_one}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 2
##   song                     length
##   <chr>                    <time>
## 1 Speak to Me              01:30 
## 2 Breathe                  02:43 
## 3 On the Run               03:30 
## 4 Time                     06:53 
## 5 The Great Gig in the Sky 04:15
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{side_two}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 2
##   song                length
##   <chr>               <time>
## 1 Money               06:30 
## 2 Us and Them         07:51 
## 3 Any Colour You Like 03:24 
## 4 Brain Damage        03:50 
## 5 Eclipse             02:03
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Bind side_one and side_two into a single dataset}
\NormalTok{side_one }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{bind_rows}\NormalTok{(side_two)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 2
##    song                     length
##    <chr>                    <time>
##  1 Speak to Me              01:30 
##  2 Breathe                  02:43 
##  3 On the Run               03:30 
##  4 Time                     06:53 
##  5 The Great Gig in the Sky 04:15 
##  6 Money                    06:30 
##  7 Us and Them              07:51 
##  8 Any Colour You Like      03:24 
##  9 Brain Damage             03:50 
## 10 Eclipse                  02:03
\end{verbatim}

\subsection{Bind rows}\label{bind-rows}

discography and jimi contain all of the information you need to create
an anthology dataset for the band The Jimi Hendrix Experience.

discography contains a data frame of each album by The Jimi Hendrix
Experience and the year of the album.

jimi contains a list of data frames of album tracks, one for each album
released by The Jimi Hendrix Experience. As Garrett explained in the
video, you can pass bind\_rows() a list of data frames like jimi to bind
together into a single data frame.

INSTRUCTIONS

Examine discography and jimi. Bind jimi into a single data frame. As you
do, save the data frame names as a column named album by specifying the
.id argument to bind\_rows(). Left join discography to the results to
make a complete data frame.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Examine discography and jimi}
\NormalTok{discography}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 2
##   album                year
##   <chr>               <int>
## 1 Are You Experienced  1967
## 2 Axis: Bold as Love   1967
## 3 Electric Ladyland    1968
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{jimi}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $`Are You Experienced`
## # A tibble: 10 x 2
##    song                     length
##    <chr>                    <time>
##  1 Purple Haze              02:46 
##  2 Manic Depression         03:46 
##  3 Hey Joe                  03:23 
##  4 May This Be Love         03:14 
##  5 I Don't Live Today       03:55 
##  6 The Wind Cries Mary      03:21 
##  7 Fire                     02:34 
##  8 Third Stone from the Sun 06:40 
##  9 Foxy Lady                03:15 
## 10 Are You Experienced?     03:55 
## 
## $`Axis: Bold As Love`
## # A tibble: 13 x 2
##    song                 length
##    <chr>                <time>
##  1 EXP                  01:55 
##  2 Up from the Skies    02:55 
##  3 Spanish Castle Magic 03:00 
##  4 Wait Until Tomorrow  03:00 
##  5 Ain't No Telling     01:46 
##  6 Little Wing          02:24 
##  7 If 6 was 9           05:32 
##  8 You Got Me Floatin   02:45 
##  9 Castles Made of Sand 02:46 
## 10 She's So Fine        02:37 
## 11 One Rainy Wish       03:40 
## 12 Little Miss Lover    02:20 
## 13 Bold as Love         04:11 
## 
## $`Electric Ladyland`
## # A tibble: 16 x 2
##    song                                       length
##    <chr>                                      <time>
##  1 And the Gods Made Love                     01:21 
##  2 Have You Ever Been (To Electric Ladyland)  02:11 
##  3 Crosstown Traffic                          02:25 
##  4 Voodoo Chile                               15:00 
##  5 Little Miss Strange                        02:52 
##  6 Long Hot Summer Night                      03:27 
##  7 Come On (Part 1)                           04:09 
##  8 Gypsy Eyes                                 03:43 
##  9 Burning of the Midnight Lamp               03:39 
## 10 Rainy Day, Dream Away                      03:42 
## 11 1983... (A Merman I Should Turn to Be)     13:39 
## 12 Moon, Turn the Tides... Gently Gently Away 01:02 
## 13 Still Raining, Still Dreaming              04:25 
## 14 House Burning Down                         04:33 
## 15 All Along the Watchtower                   04:01 
## 16 Voodoo Child (Slight Return)               05:12
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{jimi }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Bind jimi into a single data frame}
\StringTok{  }\KeywordTok{bind_rows}\NormalTok{(}\DataTypeTok{.id =} \StringTok{"album"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Make a complete data frame}
\StringTok{  }\KeywordTok{left_join}\NormalTok{(discography, }\DataTypeTok{by =} \StringTok{"album"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 39 x 4
##    album               song                     length  year
##    <chr>               <chr>                    <time> <int>
##  1 Are You Experienced Purple Haze              02:46   1967
##  2 Are You Experienced Manic Depression         03:46   1967
##  3 Are You Experienced Hey Joe                  03:23   1967
##  4 Are You Experienced May This Be Love         03:14   1967
##  5 Are You Experienced I Don't Live Today       03:55   1967
##  6 Are You Experienced The Wind Cries Mary      03:21   1967
##  7 Are You Experienced Fire                     02:34   1967
##  8 Are You Experienced Third Stone from the Sun 06:40   1967
##  9 Are You Experienced Foxy Lady                03:15   1967
## 10 Are You Experienced Are You Experienced?     03:55   1967
## # ... with 29 more rows
\end{verbatim}

\subsection{Bind columns}\label{bind-columns}

Let's make a compilation of Hank Williams' 67 singles. To do this, you
can use hank\_years and hank\_charts:

hank\_years contains the name and release year of each of Hank Williams'
67 singles. hank\_charts contains the name of each of Hank Williams' 67
singles as well as the highest position it earned on the Billboard sales
charts. Each dataset contains the same songs, but hank\_years is
arranged chronologically by year, while hank\_charts is arranged
alphabetically by song title.

INSTRUCTIONS

Examine hank\_years and hank\_charts. How should you bind the two
datasets? Use arrange() to reorder hank\_years alphabetically by song
title. Select just the year column of the result. Bind the year column
to hank\_charts. arrange() the resulting dataset chronologically by
year, then alphabetically by song title within each year.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Examine hank_years and hank_charts}
\NormalTok{hank_years}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 67 x 2
##     year song                                   
##    <int> <chr>                                  
##  1  1947 Move It On Over                        
##  2  1947 My Love for You (Has Turned to Hate)   
##  3  1947 Never Again (Will I Knock on Your Door)
##  4  1947 On the Banks of the Old Ponchartrain   
##  5  1947 Pan American                           
##  6  1947 Wealth Won't Save Your Soul            
##  7  1948 A Mansion on the Hill                  
##  8  1948 Honky Tonkin'                          
##  9  1948 I Saw the Light                        
## 10  1948 I'm a Long Gone Daddy                  
## # ... with 57 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{hank_charts}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 67 x 2
##    song                             peak
##    <chr>                           <int>
##  1 (I Heard That) Lonesome Whistle     9
##  2 (I'm Gonna) Sing, Sing, Sing       NA
##  3 A Home in Heaven                   NA
##  4 A Mansion on the Hill              12
##  5 A Teardrop on a Rose               NA
##  6 At the First Fall of Snow          NA
##  7 Baby, We're Really in Love          4
##  8 California Zephyr                  NA
##  9 Calling You                        NA
## 10 Cold, Cold Heart                    1
## # ... with 57 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{hank_years }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Reorder hank_years alphabetically by song title}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(song) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Select just the year column}
\StringTok{  }\KeywordTok{select}\NormalTok{(year) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Bind the year column}
\StringTok{  }\KeywordTok{bind_cols}\NormalTok{(hank_charts) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Arrange the finished dataset}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(year)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 67 x 3
##     year song                                     peak
##    <int> <chr>                                   <int>
##  1  1947 Move It On Over                             4
##  2  1947 My Love for You (Has Turned to Hate)       NA
##  3  1947 Never Again (Will I Knock on Your Door)    NA
##  4  1947 On the Banks of the Old Ponchartrain       NA
##  5  1947 Pan American                               NA
##  6  1947 Wealth Won't Save Your Soul                NA
##  7  1948 A Mansion on the Hill                      12
##  8  1948 Honky Tonkin'                              14
##  9  1948 I Just Don't Like This Kind of Living       5
## 10  1948 I'm Satisfied with You                     NA
## # ... with 57 more rows
\end{verbatim}

\subsection{Make a data frame}\label{make-a-data-frame}

Let's make a Greatest Hits compilation for Hank Williams. hank\_year,
hank\_song, and hank\_peak contain the columns of the data frame you
made in the last exercise.

INSTRUCTIONS

Use data\_frame() to combine hank\_year, hank\_song, and hank\_peak into
a data frame that has the column names year, song, and peak; in that
order. Use filter() to extract just the songs where peak equals 1
(i.e.~Hank's number one hits.)

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Make combined data frame using data_frame()}
\KeywordTok{data_frame}\NormalTok{(}\DataTypeTok{year =}\NormalTok{ hank_year, }
           \DataTypeTok{song =}\NormalTok{ hank_song, }
           \DataTypeTok{peak =}\NormalTok{ hank_peak) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Extract songs where peak equals 1}
\StringTok{  }\KeywordTok{filter}\NormalTok{(peak }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 11 x 3
##     year song                                    peak
##    <int> <chr>                                  <int>
##  1  1948 Cold, Cold Heart                           1
##  2  1949 Hey Good Lookin'                           1
##  3  1950 I'll Never Get Out of This World Alive     1
##  4  1950 Jambalaya (On the Bayou)                   1
##  5  1951 Kaw-Liga                                   1
##  6  1951 Long Gone Lonesome Blues                   1
##  7  1951 Lovesick Blues                             1
##  8  1952 Moanin' the Blues                          1
##  9  1955 Take These Chains from My Heart            1
## 10  1957 Why Don't You Love Me                      1
## 11  1989 Your Cheatin' Heart                        1
\end{verbatim}

\subsection{Lists of columns}\label{lists-of-columns}

As a data scientist, you should always be prepared to handle raw data
that comes in many different formats.

hank saves Hank Williams' singles in a different way, as a list of
vectors. Can you turn hank into the same dataset that you made in the
last exercise?

INSTRUCTIONS

Examine the contents of hank. Use as\_data\_frame() to convert the hank
list into a data frame. Use filter to extract the number one hits.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Examine the contents of hank}
\NormalTok{hank}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $year
##  [1] 1947 1947 1947 1947 1947 1947 1948 1948 1948 1948 1948 1949 1949 1949
## [15] 1949 1949 1949 1949 1949 1950 1950 1950 1950 1950 1950 1950 1950 1951
## [29] 1951 1951 1951 1951 1951 1951 1951 1952 1952 1952 1952 1952 1952 1953
## [43] 1953 1953 1953 1953 1953 1954 1954 1954 1954 1955 1955 1955 1955 1955
## [57] 1956 1956 1956 1956 1957 1957 1957 1958 1965 1966 1989
## 
## $song
##  [1] "(I Heard That) Lonesome Whistle"                
##  [2] "(I'm Gonna) Sing, Sing, Sing"                   
##  [3] "A Home in Heaven"                               
##  [4] "A Mansion on the Hill"                          
##  [5] "A Teardrop on a Rose"                           
##  [6] "At the First Fall of Snow"                      
##  [7] "Baby, We're Really in Love"                     
##  [8] "California Zephyr"                              
##  [9] "Calling You"                                    
## [10] "Cold, Cold Heart"                               
## [11] "Crazy Heart"                                    
## [12] "Dear John"                                      
## [13] "Half as Much"                                   
## [14] "Hey Good Lookin'"                               
## [15] "Honky Tonk Blues"                               
## [16] "Honky Tonkin'"                                  
## [17] "How Can You Refuse Him Now"                     
## [18] "Howlin' At the Moon"                            
## [19] "I Can't Help It (If I'm Still in Love With You)"
## [20] "I Just Don't Like This Kind of Living"          
## [21] "I Saw the Light"                                
## [22] "I Won't Be Home No More"                        
## [23] "I'll Never Get Out of This World Alive"         
## [24] "I'm a Long Gone Daddy"                          
## [25] "I'm Satisfied with You"                         
## [26] "I'm So Lonesome I Could Cry"                    
## [27] "Jambalaya (On the Bayou)"                       
## [28] "Just Waitin'"                                   
## [29] "Kaw-Liga"                                       
## [30] "Kaw-Liga"                                       
## [31] "Leave Me Alone with the Blues"                  
## [32] "Long Gone Lonesome Blues"                       
## [33] "Lost Highway"                                   
## [34] "Lovesick Blues"                                 
## [35] "Mind Your Own Business"                         
## [36] "Moanin' the Blues"                              
## [37] "Mother Is Gone"                                 
## [38] "Move It On Over"                                
## [39] "My Bucket's Got a Hole in It"                   
## [40] "My Love for You (Has Turned to Hate)"           
## [41] "My Son Calls Another Man Daddy"                 
## [42] "My Sweet Love Ain't Around"                     
## [43] "Never Again (Will I Knock on Your Door)"        
## [44] "Never Again (Will I Knock on Your Door)"        
## [45] "Nobody's Lonesome for Me"                       
## [46] "On the Banks of the Old Ponchartrain"           
## [47] "Pan American"                                   
## [48] "Please Don't Let Me Love You"                   
## [49] "Ready to Go Home"                               
## [50] "Settin' the Woods on Fire"                      
## [51] "Singing Waterfall"                              
## [52] "Take These Chains from My Heart"                
## [53] "Thank God"                                      
## [54] "The Pale Horse and His Rider"                   
## [55] "The Waltz of the Wind"                          
## [56] "There's a Tear in My Beer"                      
## [57] "There's No Room in My Heart for the Blues"      
## [58] "They'll Never Take Her Love from Me"            
## [59] "Wealth Won't Save Your Soul"                    
## [60] "Weary Blues from Waitin'"                       
## [61] "Wedding Bells"                                  
## [62] "Why Don't You Love Me"                          
## [63] "Why Should We Try Anymore"                      
## [64] "You Better Keep It on Your Mind"                
## [65] "You Win Again"                                  
## [66] "You're Gonna Change (Or I'm Gonna Leave)"       
## [67] "Your Cheatin' Heart"                            
## 
## $peak
##  [1]  9 NA NA 12 NA NA  4 NA NA  1  4  8  2  1  2 14 NA  3  2  5 NA  4  1
## [24]  6 NA  2  1 NA  1 NA NA  1 12  1  5  1 NA  4  2 NA  9 NA NA  6  9 NA
## [47] NA  9 NA  2 NA  1 NA NA NA  7 NA  5 NA  7  2  1  9 NA 10  4  1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Convert the hank list into a data frame}
\KeywordTok{as_data_frame}\NormalTok{(hank) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Extract songs where peak equals 1}
\StringTok{  }\KeywordTok{filter}\NormalTok{(peak }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 11 x 3
##     year song                                    peak
##    <int> <chr>                                  <int>
##  1  1948 Cold, Cold Heart                           1
##  2  1949 Hey Good Lookin'                           1
##  3  1950 I'll Never Get Out of This World Alive     1
##  4  1950 Jambalaya (On the Bayou)                   1
##  5  1951 Kaw-Liga                                   1
##  6  1951 Long Gone Lonesome Blues                   1
##  7  1951 Lovesick Blues                             1
##  8  1952 Moanin' the Blues                          1
##  9  1955 Take These Chains from My Heart            1
## 10  1957 Why Don't You Love Me                      1
## 11  1989 Your Cheatin' Heart                        1
\end{verbatim}

\subsection{Lists of rows (data
frames)}\label{lists-of-rows-data-frames}

michael contains a list of data frames, one for each album released by
Michael Jackson. The code in the editor attempts to bind the data frames
into a single data frame and then extract a data frame of the top tracks
on each album.

However, the code runs into a problem. The commented line fails because
as\_data\_frame() combines a list of column vectors into a data frame.
However, michael is a list of data frames.

Can you fix the code? After all, you have seen something like this
before.

INSTRUCTIONS

Examine the contents of michael. Replace the commented code in the
editor with a call to a dplyr function, which should bind the datasets
in the list into a single data frame, adding an album column as it does.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#Note from Neil: Do not have the "michael" list of dataframes}

\CommentTok{# Examine the contents of michael}
\CommentTok{#michael}
\CommentTok{#}
\CommentTok{#  bind_rows(michael, .id = "album") %>% }
\CommentTok{#  group_by(album) %>% }
\CommentTok{#  mutate(rank = min_rank(peak)) %>% }
\CommentTok{#  filter(rank == 1) %>% }
\CommentTok{#  select(-rank, -peak)}
\end{Highlighting}
\end{Shaded}

\subsection{Results}\label{results}

sixties contains the top selling albums in the US in the 1960s. It
stores year as a numeric (double). When you combine it with seventies,
which stores year as a factor, bind\_rows() returns an error.

You can fix this by coercing seventies\$year to a numeric. But if you do
it like this, something surprising happens.

\begin{verbatim}
seventies %>% 
  mutate(year = as.numeric(year))
\end{verbatim}

Can you fix things?

INSTRUCTIONS

Coerce seventies\$year into a useful numeric. Bind the updated version
of seventies to sixties and examine the results. Make sure they are
sensible.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{seventies }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Coerce seventies$year into a useful numeric}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{year =} \KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(year))) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Bind the updated version of seventies to sixties}
\StringTok{  }\KeywordTok{bind_rows}\NormalTok{(sixties) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{arrange}\NormalTok{(year)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 20 x 3
##     year album                          band                           
##    <dbl> <chr>                          <chr>                          
##  1  1960 The Sound of Music             Original Broadway Cast         
##  2  1961 Camelot                        Original Broadway Cast         
##  3  1962 West Side Story                Soundtrack                     
##  4  1963 West Side Story                Soundtrack                     
##  5  1964 Hello, Dolly!                  Original Broadway Cast         
##  6  1965 Mary Poppins                   Soundtrack                     
##  7  1966 Whipped Cream & Other Delights Herb Alpert & The Tijuana Brass
##  8  1967 More of The Monkees            The Monkees                    
##  9  1968 Are You Experienced?           The Jimi Hendrix Experience    
## 10  1969 In-A-Gadda-Da-Vida             Iron Butterfly                 
## 11  1970 Bridge Over Troubled Water     Simon and Garfunkel            
## 12  1971 Jesus Christ Superstar         Various Artists                
## 13  1972 Harvest                        Neil Young                     
## 14  1973 The World is a Ghetto          War                            
## 15  1974 Goodbye Yellow Brick Road      Elton John                     
## 16  1975 Elton John's Greatest Hits     Elton John                     
## 17  1976 Peter Frampton                 Frampton Comes Alive           
## 18  1977 Rumours                        Fleetwood Mac                  
## 19  1978 Saturday Night Fever           Bee Gees                       
## 20  1979 Billy Joel                     52nd Street
\end{verbatim}

\section{Chapter 4: Advanced joining}\label{chapter-4-advanced-joining}

Now that you have the basics, let's dive deep into the mechanics of
joins. This chapter will show you how to spot common join problems, how
to join based on multiple or mismatched keys, how to join multiple
tables, and how to recreate dplyr's joins with SQL and base R.

\subsection{Spot the key}\label{spot-the-key}

R's data frames can store important information in the row.names
attribute. This is not a tidy way to store data, but it does happen
quite commonly. If the primary key of your dataset is stored in
row.names, you will have trouble joining it to other datasets.

For example, stage\_songs contains information about songs that appear
in musicals. However, it stores the primary key (song name) in the
row.names attribute. As a result, you cannot access the key with a join
function.

One way to remedy this problem is to use the function
rownames\_to\_column() from the tibble package. rownames\_to\_column()
returns a copy of a dataset with the row names added to the data as a
column.

INSTRUCTIONS

Load the tibble package. Use rownames\_to\_column() to add the row names
of stage\_songs to the data frame as a column named song. Left join
stage\_writers to stage\_songs.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Load the tibble package}
\KeywordTok{library}\NormalTok{(tibble)}

\NormalTok{stage_songs }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Add row names as a column named song}
\StringTok{  }\KeywordTok{rownames_to_column}\NormalTok{(}\DataTypeTok{var =} \StringTok{"song"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Left join stage_writers to stage_songs}
\StringTok{  }\KeywordTok{left_join}\NormalTok{(stage_writers, }\DataTypeTok{by =} \StringTok{"song"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 5
##   song  X1                     musical               year composer
##   <chr> <chr>                  <chr>                <int> <chr>   
## 1 1     Children Will Listen   Into the Woods        1986 <NA>    
## 2 2     Maria                  West Side Story       1957 <NA>    
## 3 3     Memory                 Cats                  1981 <NA>    
## 4 4     The Music of the Night Phantom of the Opera  1986 <NA>
\end{verbatim}

\subsection{Missing keys}\label{missing-keys}

Julie Andrews is a famous singer who performed in The Sound of Music,
which is documented in the singers data frame. The two\_songs data frame
records a couple of songs that she sang during her career.

Unfortunately, when you join the datasets together, something odd
happens. According to the result, who sings A Spoonful of Sugar? Why
does this happen?

You can avoid this outcome by removing rows that contain NAs in the keys
before joining.

INSTRUCTIONS

Take a look at singers and two\_songs in the console.

Examine the result of joining singers to two\_songs. Add a filter() call
to the pipe to remove NA's from the key column of two\_songs before
calling inner\_join().

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Examine the result of joining singers to two_songs}
\NormalTok{two_songs }\OperatorTok{%>%}\StringTok{ }\KeywordTok{inner_join}\NormalTok{(singers, }\DataTypeTok{by =} \StringTok{"movie"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 3
##   song                movie              singer               
##   <chr>               <chr>              <chr>                
## 1 Do-Re-Mi            The Sound of Music Julie Andrews        
## 2 A Spoonful of Sugar <NA>               Arnold Schwarzenegger
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Remove NA's from key before joining}
\NormalTok{two_songs }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{filter}\NormalTok{(}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(movie)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{inner_join}\NormalTok{(singers, }\DataTypeTok{by =} \StringTok{"movie"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 3
##   song     movie              singer       
##   <chr>    <chr>              <chr>        
## 1 Do-Re-Mi The Sound of Music Julie Andrews
\end{verbatim}

\subsection{A subset of keys}\label{a-subset-of-keys}

Often the same column name will be used by two datasets to refer to
different things. For example, the data frame movie\_studios uses name
to refer to the name of a movie studio. movie\_years uses name to refer
to the name of an actor.

You could join these datasets (they describe the same movies), but you
wouldn't want to use the name column to do so!

dplyr will ignore duplicate column names if you set the by argument and
do not include the duplicated name in the argument. When you do this,
dplyr will treat the columns in the normal fashion, but it will add .x
and .y to the duplicated names to help you tell the columns apart.

INSTRUCTIONS

Left join movie\_studios to movie\_years by the movie column. What
happens to the duplicated column names? Use rename() to rename the name
column of movie\_years to artist, and the name column of movie\_studios
to studio. As an example, rename(data, new\_name = old\_name) renames
old\_name to new\_name in data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{movie_years }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Left join movie_studios to movie_years}
\StringTok{  }\KeywordTok{left_join}\NormalTok{(movie_studios, }\DataTypeTok{by =} \StringTok{"movie"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Rename the columns: artist and studio}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{artist =}\NormalTok{ name.x, }\DataTypeTok{studio =}\NormalTok{ name.y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 4
##    movie                   artist         year studio               
##    <chr>                   <chr>         <int> <chr>                
##  1 The Road to Morocco     Bing Crosby    1942 Paramount Pictures   
##  2 Going My Way            Bing Crosby    1944 Paramount Pictures   
##  3 Anchors Aweigh          Frank Sinatra  1945 Metro-Goldwyn-Mayer  
##  4 Till the Clouds Roll By Frank Sinatra  1946 Metro-Goldwyn-Mayer  
##  5 White Christmas         Bing Crosby    1954 Paramount Pictures   
##  6 The Tender Trap         Frank Sinatra  1955 Metro-Goldwyn-Mayer  
##  7 High Society            Bing Crosby    1956 Metro-Goldwyn-Mayer  
##  8 The Joker is Wild       Frank Sinatra  1957 Paramount Pictures   
##  9 Pal Joey                Frank Sinatra  1957 Columbia Pictures    
## 10 Can-Can                 Frank Sinatra  1960 Twentieth-Century Fox
\end{verbatim}

\subsection{Mis-matched key names}\label{mis-matched-key-names}

Just as the same name can refer to different things in different
datasets, different names can refer to the same thing. For example,
elvis\_movies and elvis\_songs both describe movies starring Elvis
Presley, but each uses a different column name to describe the name of
the movie.

This type of inconsistency can be frustrating when you wish to join data
based on the inconsistently named variable.

To make the join, set by to a named vector. The names of the vector will
refer to column names in the primary dataset (x). The values of the
vector will correspond to the column names in the secondary dataset (y),
e.g.

\begin{verbatim}
x %>% left_join(y, by = c("x.name1" = "y.name2"))
\end{verbatim}

dplyr will make the join and retain the names in the primary dataset.

INSTRUCTIONS

Identify the column in elvis\_songs that corresponds to a column in
elvis\_movies. Left join elvis\_songs to elvis\_movies by this column.
Use rename() to give the result the column names movie, year, and song.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Identify the key column}
\NormalTok{elvis_songs}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 2
##   name                                 movie         
##   <chr>                                <chr>         
## 1 (You're So Square) Baby I Don't Care Jailhouse Rock
## 2 I Can't Help Falling in Love         Blue Hawaii   
## 3 Jailhouse Rock                       Jailhouse Rock
## 4 Viva Las Vegas                       Viva Las Vegas
## 5 You Don't Know Me                    Clambake
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{elvis_movies}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 2
##   name            year
##   <chr>          <int>
## 1 Jailhouse Rock  1957
## 2 Blue Hawaii     1961
## 3 Viva Las Vegas  1963
## 4 Clambake        1967
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{elvis_movies }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Left join elvis_songs to elvis_movies by this column}
\StringTok{  }\KeywordTok{left_join}\NormalTok{(elvis_songs, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"name"}\NormalTok{ =}\StringTok{ "movie"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Rename columns}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{movie =}\NormalTok{ name, }\DataTypeTok{song =}\NormalTok{ name.y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 3
##   movie           year song                                
##   <chr>          <int> <chr>                               
## 1 Jailhouse Rock  1957 (You're So Square) Baby I Don't Care
## 2 Jailhouse Rock  1957 Jailhouse Rock                      
## 3 Blue Hawaii     1961 I Can't Help Falling in Love        
## 4 Viva Las Vegas  1963 Viva Las Vegas                      
## 5 Clambake        1967 You Don't Know Me
\end{verbatim}

\subsection{More mismatched names}\label{more-mismatched-names}

Now, you'll practice what you learned in the last exercise.

movie\_years and movie\_directors both describe movies that feature
Frank Sinatra and Bing Crosby. However, each data frame uses different
column names to refer to the key variables that connect the datasets.

Can you join the data?

INSTRUCTIONS

Identify the key columns that connect movie\_directors to movie\_years.
Left join movie\_directors to movie\_years. Use select() to arrange the
columns in the following order with the following names: year, movie,
artist, director, studio.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Identify the key columns}
\NormalTok{movie_directors}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 3
##    name                    director        studio               
##    <chr>                   <chr>           <chr>                
##  1 Anchors Aweigh          George Sidney   Metro-Goldwyn-Mayer  
##  2 Can-Can                 Walter Lang     Twentieth-Century Fox
##  3 Going My Way            Leo McCarey     Paramount Pictures   
##  4 High Society            Charles Walters Metro-Goldwyn-Mayer  
##  5 Pal Joey                George Sidney   Columbia Pictures    
##  6 The Joker is Wild       Charles Vidor   Paramount Pictures   
##  7 The Road to Morocco     David Butler    Paramount Pictures   
##  8 The Tender Trap         Charles Walters Metro-Goldwyn-Mayer  
##  9 Till the Clouds Roll By Richard Whorf   Metro-Goldwyn-Mayer  
## 10 White Christmas         Michael Curtiz  Paramount Pictures
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{movie_years}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 3
##    movie                   name           year
##    <chr>                   <chr>         <int>
##  1 The Road to Morocco     Bing Crosby    1942
##  2 Going My Way            Bing Crosby    1944
##  3 Anchors Aweigh          Frank Sinatra  1945
##  4 Till the Clouds Roll By Frank Sinatra  1946
##  5 White Christmas         Bing Crosby    1954
##  6 The Tender Trap         Frank Sinatra  1955
##  7 High Society            Bing Crosby    1956
##  8 The Joker is Wild       Frank Sinatra  1957
##  9 Pal Joey                Frank Sinatra  1957
## 10 Can-Can                 Frank Sinatra  1960
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{movie_years }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Left join movie_directors to movie_years}
\StringTok{  }\KeywordTok{left_join}\NormalTok{(movie_directors, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"movie"}\NormalTok{ =}\StringTok{ "name"}\NormalTok{)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Arrange the columns using select()}
\StringTok{  }\KeywordTok{select}\NormalTok{(year, movie, }\DataTypeTok{artist =} \StringTok{"name"}\NormalTok{, director, studio)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 5
##     year movie                artist       director      studio           
##    <int> <chr>                <chr>        <chr>         <chr>            
##  1  1942 The Road to Morocco  Bing Crosby  David Butler  Paramount Pictur~
##  2  1944 Going My Way         Bing Crosby  Leo McCarey   Paramount Pictur~
##  3  1945 Anchors Aweigh       Frank Sinat~ George Sidney Metro-Goldwyn-Ma~
##  4  1946 Till the Clouds Rol~ Frank Sinat~ Richard Whorf Metro-Goldwyn-Ma~
##  5  1954 White Christmas      Bing Crosby  Michael Curt~ Paramount Pictur~
##  6  1955 The Tender Trap      Frank Sinat~ Charles Walt~ Metro-Goldwyn-Ma~
##  7  1956 High Society         Bing Crosby  Charles Walt~ Metro-Goldwyn-Ma~
##  8  1957 The Joker is Wild    Frank Sinat~ Charles Vidor Paramount Pictur~
##  9  1957 Pal Joey             Frank Sinat~ George Sidney Columbia Pictures
## 10  1960 Can-Can              Frank Sinat~ Walter Lang   Twentieth-Centur~
\end{verbatim}

\subsection{Join multiple tables}\label{join-multiple-tables}

purrr's reduce() function is very useful for joining together multiple
datasets. Let's practice using it with three new datasets.

supergroups lists the members of several ``supergroup'' bands, which are
bands made from the members of other famous bands. more\_bands lists the
original band membership of many musicians, including those in
supergroups. And more\_artists lists the instruments that various
artists played.

Can you join these datasets into a single, coherent dataset?

INSTRUCTIONS

Load the purrr library. Place supergroups, more\_bands, and
more\_artists into a list, in that order. Use reduce() to join together
supergroups, more\_bands, and more\_artists into a dataset that contains
all available information about each artist in supergroups (and no
others).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Load the purrr library}
\KeywordTok{library}\NormalTok{(purrr)}

\CommentTok{# Place supergroups, more_bands, and more_artists into a list}
\KeywordTok{list}\NormalTok{(supergroups, more_bands, more_artists) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Use reduce to join together the contents of the list}
\StringTok{  }\KeywordTok{reduce}\NormalTok{(left_join, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"first"}\NormalTok{, }\StringTok{"last"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 19 x 5
##    supergroup             first   last      band                instrument
##    <chr>                  <chr>   <chr>     <chr>               <chr>     
##  1 Cream                  Ginger  Baker     Graham Bond Organi~ drums     
##  2 Cream                  Jack    Bruce     Graham Bond Organi~ bass      
##  3 Cream                  Jack    Bruce     Graham Bond Organi~ bass      
##  4 Cream                  Jack    Bruce     Manfred Mann        bass      
##  5 Cream                  Jack    Bruce     Manfred Mann        bass      
##  6 Cream                  Eric    Clapton   The Yardbirds       guitar    
##  7 Crosby, Stills, Nash,~ David   Crosby    The Byrds           guitar    
##  8 Crosby, Stills, Nash,~ Graham  Nash      The Hollies         guitar    
##  9 Crosby, Stills, Nash,~ Stephen Stills    Buffalo Springfield guitar    
## 10 Crosby, Stills, Nash,~ Neil    Young     Buffalo Springfield guitar    
## 11 The Highwaymen         Johnny  Cash      <NA>                guitar    
## 12 The Highwaymen         Waylon  Jennings  <NA>                guitar    
## 13 The Highwaymen         Kris    Kristoff~ <NA>                guitar    
## 14 The Highwaymen         Willie  Nelson    <NA>                guitar    
## 15 The Traveling Wilburys Bob     Dylan     <NA>                guitar    
## 16 The Traveling Wilburys George  Harrison  The Beatles         guitar    
## 17 The Traveling Wilburys Jeff    Lynne     Electric Light Orc~ vocals    
## 18 The Traveling Wilburys Roy     Orbison   <NA>                guitar    
## 19 The Traveling Wilburys Tom     Petty     Tom Petty and the ~ vocals
\end{verbatim}

\subsection{Filter multiple tables}\label{filter-multiple-tables}

Nice work! The job of reduce() is to apply a function in an iterative
fashion to many datasets. As a result, reduce() works well with all of
the dplyr join functions.

For example, you can use reduce() to filter observations with a
filtering join.

INSTRUCTIONS

Use reduce() to return just the rows of more\_artists that appear in all
three datasets.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{list}\NormalTok{(more_artists, more_bands, supergroups) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\CommentTok{# Return rows of more_artists in all three datasets}
\StringTok{  }\KeywordTok{reduce}\NormalTok{(semi_join, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"first"}\NormalTok{, }\StringTok{"last"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 11 x 3
##    first   last     instrument
##    <chr>   <chr>    <chr>     
##  1 David   Crosby   guitar    
##  2 Eric    Clapton  guitar    
##  3 George  Harrison guitar    
##  4 Ginger  Baker    drums     
##  5 Graham  Nash     guitar    
##  6 Jack    Bruce    bass      
##  7 Jack    Bruce    bass      
##  8 Jeff    Lynne    vocals    
##  9 Neil    Young    guitar    
## 10 Stephen Stills   guitar    
## 11 Tom     Petty    vocals
\end{verbatim}

\subsection{Base R}\label{base-r}

dplyr joins are also similar to the merge() function in base R.

For example, the code in the editor uses merge() and arrange() to
perform a left\_join() on bands and artists.

INSTRUCTIONS

Alter the code to perform the join with a dplyr function. Remove
arrange() if your solution does not need it.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#THIS:}
\KeywordTok{merge}\NormalTok{(bands, artists, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"first"}\NormalTok{, }\StringTok{"last"}\NormalTok{), }\DataTypeTok{all.x =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{arrange}\NormalTok{(band)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        first      last               band instrument
## 1      Jimmy      Page       Led Zeppelin     Guitar
## 2       John    Bonham       Led Zeppelin       <NA>
## 3  John Paul     Jones       Led Zeppelin       <NA>
## 4     Robert     Plant       Led Zeppelin       <NA>
## 5     George  Harrison        The Beatles     Guitar
## 6       John    Lennon        The Beatles     Guitar
## 7       Paul McCartney        The Beatles       Bass
## 8      Ringo     Starr        The Beatles      Drums
## 9      Jimmy   Buffett  The Coral Reefers     Guitar
## 10   Charlie     Watts The Rolling Stones       <NA>
## 11     Keith  Richards The Rolling Stones     Guitar
## 12      Mick    Jagger The Rolling Stones     Vocals
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#is equivalant to the below dplyr function... BUt the dplyr function will convert it to a tibble DF.}

\CommentTok{# Alter the code to perform the join with a dplyr function}
\KeywordTok{left_join}\NormalTok{(bands, artists, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"first"}\NormalTok{, }\StringTok{"last"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 12 x 4
##    first     last      band               instrument
##    <chr>     <chr>     <chr>              <chr>     
##  1 John      Bonham    Led Zeppelin       <NA>      
##  2 John Paul Jones     Led Zeppelin       <NA>      
##  3 Jimmy     Page      Led Zeppelin       Guitar    
##  4 Robert    Plant     Led Zeppelin       <NA>      
##  5 George    Harrison  The Beatles        Guitar    
##  6 John      Lennon    The Beatles        Guitar    
##  7 Paul      McCartney The Beatles        Bass      
##  8 Ringo     Starr     The Beatles        Drums     
##  9 Jimmy     Buffett   The Coral Reefers  Guitar    
## 10 Mick      Jagger    The Rolling Stones Vocals    
## 11 Keith     Richards  The Rolling Stones Guitar    
## 12 Charlie   Watts     The Rolling Stones <NA>
\end{verbatim}

\section{Chapter 5: Case study}\label{chapter-5-case-study}

You know the ins and outs of two-table verbs with dplyr, but your
knowledge is untried! Let's cement what you've learned with a real world
application.


\end{document}
